var fs = require('fs'),
    removed = 0;

var walk = function(dir, done) {
  var results = [];

  fs.readdir(dir, function(err, list) {
    if (err) return done(err);
    var i = 0, total = list.length;
    
    (function next() {
      var file = list[i++];

      if (!file) return done(null, results);
      
      file = dir + '/' + file;
      fs.stat(file, function(err, stat) {
        if (stat && stat.isDirectory()) {
          walk(file, function(err, res) {
	          results = results.concat(res);
  	        next();
    	    });
        } else {
        	if (!/\/\.|test|example|component\.json/.test(file.toLowerCase()) && /^.*(\.js|\.json)$/.test(file.toLowerCase())) {
        		//if (/\.markdown$/.test(file)) console.log(file)
        		results.push(file);
        	} else {
        		removed++;
        	}
          	
          next();
        }
      });

    })(); //next
  }); //readdir
}; //walk

walk(__dirname + '/node_modules', function(err, results) {
  if (err) throw err;

  console.log('removed ' + removed + ' files\n');

  var fileextensions = {};
  for (var i = results.length - 1; i >= 0; i--) {
  	var ext = results[i].split('/').pop().split('.').pop();
  	fileextensions[ext] = (fileextensions[ext]) ? fileextensions[ext] + 1 : 1;
  }
  
  console.log('retained ' + results.length + ' files: ', fileextensions);

});